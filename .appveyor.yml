os: unstable

environment:
  ftp_password:
    secure: K22E4pSAup6/htlGmoSBMw==
  matrix:
    - platform: x86
      condapath: c:\Miniconda
             
    - platform: x64
      condapath: c:\Miniconda-x64

      
#branches:
#  only:
#    - master
#    - release


notifications:
  - provider: Slack
    incoming_webhook:
      secure: Ee9fFcoV1ABKmTKowaok5sUiOlRSGzCpWtwNIBFC0PpauqK+/mEt9KjeUXWsb7J7uFcAb1CKo7y/FFhHEJH6pWGMn5oV283uVnqZAB8Chac=
    template: 
       "<{{buildUrl}}|{{projectName}} build {{status}}> on {{commitDate}}:_{{commitMessage}}_\n
        Build: {{buildVersion}} (<{{commitUrl}}|{{commitId}}>)   Author: {{commitAuthor}}\n         
        Download Executable Here:\n
        <https://rawgit.com/RuleWorld/bionetgen/master/.BioNetGen_Beta.html|https://rawgit.com/RuleWorld/bionetgen/master/.BioNetGen_Beta.html>\n
        Build Details:\n
        <{{buildUrl}}|{{buildUrl}}>"


before_build:
  - cmd: ECHO this is batch  %APPVEYOR_ACCOUNT_NAME%
  - uname -a

  
install:
  - "set PATH=%condapath%;%condapath%\\Scripts;%PATH%"
  - conda config --set always_yes yes --set changeps1 no

  - conda install m2-autoconf m2-automake-wrapper m2-make m2-m4 m2-grep m2-coreutils m2-tar m2-gzip m2-libtool m2-sed m2w64-binutils m2w64-gcc


build_script:
  - git clone https://github.com/ruleworld/nfsim.git
  - git clone https://github.com/ruleworld/atomizer.git
  - cd ./bng2 
  - mkdir bindir_nfsim_atomizer
  - bash .get_nfsim_atomizer.sh  ./bindir_nfsim_atomizer  %platform%   %ftp_password%
  - cd   ./Network3 && mkdir -p m4 && cd .. && perl make_dist.pl --build --validate   --bindir "%cd%\bindir_nfsim_atomizer"
  - bash .dist_windows.sh %platform%  
  
artifacts:
  - path: './BioNetGen*.zip'
    name:  BioNetGen
  - path: './BioNetGen*.html'
    name:  BioNetGenHTML
  
  
deploy:
  provider: FTP
  protocol: ftp
  skip_cleanup: true
  host: ftp.midcapsignals.com/BioNetGen_Beta/d_bionetgen/
  username: roberthclark
  password:
    secure: K22E4pSAup6/htlGmoSBMw==
#  artifact: /BioNetGen.*zip/   
